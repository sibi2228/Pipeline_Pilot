# Forecast Chart & Email Agent

## Description

This repository contains a Python-based agent designed to fetch sales forecast data from Google BigQuery, generate a visualization chart, and email that chart as an attachment. It utilizes the Google Agent Development Kit (ADK) to structure the agent and its tools.

## Agent: `forecast_chart_email_agent`

### Description

The `forecast_chart_email_agent` orchestrates a two-step process: first generating a forecast visualization from BigQuery data, and second, emailing that visualization. It leverages specific tools to handle each part of the task.

### Use Case & Functionality

The agent performs the following workflow:

1.  **Receive Inputs:** Takes details about the BigQuery source table (project ID, dataset ID, table ID) and email parameters (recipient address, subject, body).
2.  **Create Forecast Chart:**
    *   Calls the `create_forecast_chart` tool.
    *   This tool queries the specified BigQuery table (expecting columns like `forecast_date`, `forecasted_sales`, `forecast_lower_bound`, `forecast_upper_bound`).
    *   Uses `pandas` and `matplotlib` to generate a line chart visualizing the forecast and its confidence interval.
    *   Saves the chart locally as `forecast_chart.png`.
    *   Returns a status indicating success or failure.
3.  **Send Email:**
    *   Calls the `send_email` tool.
    *   Uses the locally saved `forecast_chart.png` as an attachment.
    *   Constructs and sends an email using SMTP (configured for Gmail in the code) with the provided recipient, subject, and body.
    *   Requires pre-configured sender email and an **App Password** for authentication.
    *   Returns a status indicating success or failure.
4.  **Return Status:** The agent likely returns the status of the last executed step or a combined status depending on the ADK execution flow.

## Tools Overview

The agent utilizes the following specialized tools:

1.  **`create_forecast_chart`:**
    *   **Purpose:** Fetches forecast data from BigQuery and generates a plot.
    *   **Input:** `project_id`, `dataset_id`, `table_id`.
    *   **Output:** Saves `forecast_chart.png` locally. Returns a status dictionary.

2.  **`send_email`:**
    *   **Purpose:** Sends an email with a specified attachment.
    *   **Input:** `to_address`, `subject`, `body`, `attachment_path` (hardcoded to use the chart generated by the other tool).
    *   **Output:** Sends an email via SMTP. Returns a status dictionary.

## Installation

To run this agent and its underlying tools, you need to install the necessary Python libraries.

1.  **Clone the repository (if you haven't already):**
    ```bash
    git clone <your-repository-url>
    cd <repository-directory>
    ```
    *(Replace `<your-repository-url>` and `<repository-directory>`)*

2.  **Create and activate a virtual environment (Recommended):**
    ```bash
    # Linux/macOS
    python3 -m venv venv
    source venv/bin/activate

    # Windows
    python -m venv venv
    .\venv\Scripts\activate
    ```

3.  **Install required libraries:**
    ```bash
    pip install google-adk google-cloud-bigquery pandas matplotlib
    ```
    *   `google-adk`: The Google Agent Development Kit framework.
    *   `google-cloud-bigquery`: For interacting with BigQuery.
    *   `pandas`: For data manipulation.
    *   `matplotlib`: For generating the forecast plot.
    *   (`smtplib`, `email` modules are built into Python).

## Configuration

This agent requires configuration for both Google Cloud and Email sending.

1.  **GCP Authentication:** The environment where you run the agent must be authenticated to GCP. The recommended method is using Application Default Credentials (ADC):
    ```bash
    gcloud auth application-default login
    ```
    Alternatively, set the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key file. Ensure the authenticated principal has permissions to read from the specified BigQuery table.

2.  **GCP Project/Dataset/Table:** The agent needs the `project_id`, `dataset_id`, and `table_id` for the source BigQuery table as input. This table should contain columns like `forecast_date`, `forecasted_sales`, `forecast_lower_bound`, and `forecast_upper_bound`.

3.  **Email Configuration (CRITICAL):**
    *   **Sender Email:** The `send_email` function currently has a hardcoded `from_address` (`romeojuli1997@gmail.com`). **You MUST change this** to the email address you want to send from.
    *   **App Password:** The `send_email` function uses a hardcoded `password` (`khhnqtlyklreknaa`). **This is NOT your regular Gmail password.** It must be an **App Password** generated specifically for this application through your Google Account settings.
        *   **How to Generate an App Password:**
            1.  Go to your Google Account settings.
            2.  Ensure **2-Step Verification** is turned ON for your account. App Passwords require this.
            3.  Navigate to Security -> 2-Step Verification -> App passwords (you might need to sign in again).
            4.  Select "Mail" for the app and "Other (Custom name)" for the device. Give it a descriptive name (e.g., "ADK Forecast Agent").
            5.  Click "Generate". Google will provide a 16-character password.
            6.  **Copy this 16-character password and replace the hardcoded `password` value in `agent.py` with it.** Treat this password securely.
    *   **Security Warning:** Hardcoding credentials directly in the code is generally discouraged for security reasons, especially in shared repositories. Consider using environment variables or a more secure configuration management system for production environments.

4.  **Local File System:** The `create_forecast_chart` tool saves `forecast_chart.png` in the directory where the agent is run. Ensure the execution environment has write permissions for this location. The `send_email` tool expects this file to exist.

## Google Agent Development Kit (ADK)

This agent is built using the Google Agent Development Kit (ADK). The ADK provides the `Agent` class and the framework for defining agent instructions, tools, and managing execution flow. For more detailed information on the ADK, please refer to the official **Google Agent Development Kit Documentation** *(<- Consider adding the actual link here if available)*.

## Usage (ADK Web UI)

The recommended way to interact with this agent is through the ADK Web UI.

1.  **Ensure Configuration:** Verify that you have completed all steps in the **Configuration** section above, especially setting up GCP authentication and replacing the hardcoded email address and **App Password** in `agent.py`.
2.  **Start the ADK Web Server:** Navigate to the directory containing your agent code in your terminal (where you installed the libraries) and run:
    ```bash
    adk web
    ```
3.  **Access the UI:** Open your web browser and go to the URL provided by the `adk web` command (usually `http://127.0.0.1:8080`).
4.  **Select the Agent:** In the ADK Web UI, find the dropdown menu for selecting an agent. Choose **`forecast_chart_email_agent`** from the list.
5.  **Provide Inputs:** The UI will likely present fields based on the agent's understanding or allow free-form input. You need to provide the necessary information for the agent to run, for example:
    *   "Create a forecast chart using project `your-gcp-project-id`, dataset `your_bq_dataset`, table `your_bq_forecast_table` and email it to `recipient@example.com` with subject 'Latest Sales Forecast' and body 'Please find the attached forecast chart.'"
    *(Adapt the prompt to include your actual BigQuery details, recipient email, desired subject, and body.)*
6.  **Run the Agent:** Submit the request through the UI. The agent will execute the `create_forecast_chart` tool followed by the `send_email` tool.
7.  **Check Output:** Observe the agent's output in the UI for status messages (success or error). Check the recipient's email inbox for the message and the attached chart. Check your local directory for the `forecast_chart.png` file.

*(This agent relies on the sequential execution of its tools. Ensure the BigQuery table exists and contains the expected data before running.)*
